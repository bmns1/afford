<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVA Tuition Affordability Survey</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .form-section { display: none; }
        .form-section.active { display: block; }
        .counter-btn { transition: background-color 0.2s; }
        .progress-bar-fill { transition: width 0.3s ease-in-out; }
        .error-text { color: #ef4444; } /* red-500 */
        .hidden-field { position: absolute; left: -5000px; top: -5000px; }
    </style>
</head>
<body class="bg-slate-50">

    <div class="container mx-auto max-w-3xl p-4 sm:p-8">
        <header class="text-center mb-8">
            <img src="https://raw.githubusercontent.com/bmns1/parent-portal/main/logo.png" alt="SVA Logo" class="h-20 w-auto mx-auto mb-4">
            <h1 class="text-4xl font-bold text-slate-900">Tuition Affordability Initiative</h1>
            <p class="text-slate-600 mt-2">Your feedback is vital for planning our school's future. Thank you for your participation.</p>
            <p class="text-slate-600 mt-2">YOur response will remain completely anonymous.</p>
        </header>

        <div class="bg-white p-6 sm:p-10 rounded-2xl shadow-lg border border-slate-200">
            <div id="progress-container" class="mb-8" style="display: none;">
                <div class="flex justify-between text-sm font-medium text-slate-600 mb-1">
                    <span id="progress-text">Step 1 of 4: Tuition Details</span>
                    <span id="progress-percent">0%</span>
                </div>
                <div class="w-full bg-slate-200 rounded-full h-2.5">
                    <div id="progress-bar" class="bg-teal-600 h-2.5 rounded-full progress-bar-fill" style="width: 0%"></div>
                </div>
            </div>

            <form id="survey-form">
                <input type="text" name="user_nickname" class="hidden-field" tabindex="-1" autocomplete="off">
                <input type="hidden" id="loadTime" name="loadTime">

                <!-- Cover Page -->
                <div id="page-1" class="form-section active">
                    <h2 class="text-2xl font-bold text-slate-800">Welcome</h2>
                    <p class="text-slate-600 mt-4 leading-relaxed">Silicon Valley Academy is committed to providing the highest quality education while remaining as affordable as possible for our families. The goal of this brief, anonymous survey is to gather essential data that will help the school board set realistic fundraising goals for the upcoming year.</p>
                    <p class="mt-4 text-slate-600">Your honest feedback is crucial to this process. Thank you for taking the time to help improve our community.</p>
                    <div class="mt-8 text-right">
                        <button type="button" onclick="nextPage(1)" class="bg-teal-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-teal-700 transition">Begin Survey</button>
                    </div>
                </div>

                <!-- Step 1 -> Page 2: Section 1 - Tuition & Income -->
                <div id="page-2" class="form-section">
                    <h2 class="text-2xl font-bold text-slate-800">Section 1: Tuition & Household Details</h2>
                    <div class="mt-6 space-y-6">
                        <div>
                            <label class="block text-base font-semibold text-slate-700">a) How many children do you have enrolled in each grade group?</label>
                            <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div class="grade-group" data-group="pkFullDay" data-tuition="16900">
                                    <p class="font-medium">Pre-K (Full-Day)</p>
                                    <div class="flex items-center gap-2 mt-1">
                                        <button type="button" class="counter-btn minus bg-slate-200 h-8 w-8 rounded-full text-lg font-bold hover:bg-slate-300">-</button>
                                        <span class="count text-lg font-semibold w-8 text-center">0</span>
                                        <button type="button" class="counter-btn plus bg-slate-200 h-8 w-8 rounded-full text-lg font-bold hover:bg-slate-300">+</button>
                                    </div>
                                </div>
                                <div class="grade-group" data-group="pkHalfDay" data-tuition="15500">
                                    <p class="font-medium">Pre-K (Half-Day)</p>
                                    <div class="flex items-center gap-2 mt-1">
                                        <button type="button" class="counter-btn minus bg-slate-200 h-8 w-8 rounded-full text-lg font-bold hover:bg-slate-300">-</button>
                                        <span class="count text-lg font-semibold w-8 text-center">0</span>
                                        <button type="button" class="counter-btn plus bg-slate-200 h-8 w-8 rounded-full text-lg font-bold hover:bg-slate-300">+</button>
                                    </div>
                                </div>
                                <div class="grade-group" data-group="elementary" data-tuition="11900">
                                    <p class="font-medium">Elementary (K-5)</p>
                                    <div class="flex items-center gap-2 mt-1">
                                        <button type="button" class="counter-btn minus bg-slate-200 h-8 w-8 rounded-full text-lg font-bold hover:bg-slate-300">-</button>
                                        <span class="count text-lg font-semibold w-8 text-center">0</span>
                                        <button type="button" class="counter-btn plus bg-slate-200 h-8 w-8 rounded-full text-lg font-bold hover:bg-slate-300">+</button>
                                    </div>
                                </div>
                                <div class="grade-group" data-group="middleSchool" data-tuition="13500">
                                    <p class="font-medium">Middle School (6-8)</p>
                                    <div class="flex items-center gap-2 mt-1">
                                        <button type="button" class="counter-btn minus bg-slate-200 h-8 w-8 rounded-full text-lg font-bold hover:bg-slate-300">-</button>
                                        <span class="count text-lg font-semibold w-8 text-center">0</span>
                                        <button type="button" class="counter-btn plus bg-slate-200 h-8 w-8 rounded-full text-lg font-bold hover:bg-slate-300">+</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="tuition-breakdown" class="bg-slate-50 p-4 rounded-lg border border-slate-200 hidden">
                            <h4 class="font-semibold text-slate-800">Estimated Tuition Breakdown</h4>
                            <div id="tuition-details" class="text-sm mt-2 space-y-1 text-slate-600"></div>
                            <div class="border-t border-slate-200 mt-2 pt-2 flex justify-between font-bold text-slate-900">
                                <span>Total Estimated Tuition:</span>
                                <span id="total-tuition">$0.00</span>
                            </div>
                        </div>

                        <div>
                            <p class="block text-sm font-medium text-slate-700">Does the total estimated tuition above (before aid/discounts) seem correct?</p>
                             <div class="mt-2 flex space-x-4">
                                <label class="inline-flex items-center"><input type="radio" class="form-radio" name="tuitionLooksOk" value="Yes" checked> <span class="ml-2">Yes</span></label>
                                <label class="inline-flex items-center"><input type="radio" class="form-radio" name="tuitionLooksOk" value="No"> <span class="ml-2">No</span></label>
                            </div>
                        </div>

                        <div>
                            <label class="block text-base font-semibold text-slate-700">b) What is your estimated total household income for this year?</label>
                            <p class="text-sm text-slate-500">This data is crucial and will remain anonymous. It helps us understand the tuition-to-income ratio for our families.</p>
                            <div class="mt-2 space-y-2">
                                <label class="block"><input type="radio" name="householdIncome" value="<100k" class="form-radio"> <$100,000</label>
                                <label class="block"><input type="radio" name="householdIncome" value="100-150k" class="form-radio"> $100,000 - $149,999</label>
                                <label class="block"><input type="radio" name="householdIncome" value="150-200k" class="form-radio"> $150,000 - $199,999</label>
                                <label class="block"><input type="radio" name="householdIncome" value="200-250k" class="form-radio"> $200,000 - $249,999</label>
                                <label class="block"><input type="radio" name="householdIncome" value=">250k" class="form-radio"> >$250,000</label>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-base font-semibold text-slate-700">c) Is your family receiving any financial assistance or multi-student discounts this year?</label>
                            <div class="mt-2 space-y-2">
                                <label class="block"><input type="radio" name="receivesAid" value="Yes" class="form-radio"> Yes</label>
                                <label class="block"><input type="radio" name="receivesAid" value="No" class="form-radio"> No</label>
                                <label class="block"><input type="radio" name="receivesAid" value="Prefer not to answer" class="form-radio"> Prefer not to answer</label>
                            </div>
                        </div>

                        <div>
                            <label class="block text-base font-semibold text-slate-700">d) How would you describe your household?</label>
                            <div class="mt-2 space-y-2">
                                <label class="block"><input type="radio" name="householdType" value="Single Parent" class="form-radio"> Single-parent household</label>
                                <label class="block"><input type="radio" name="householdType" value="One Working Parent" class="form-radio"> Two-parent household, one working parent</label>
                                <label class="block"><input type="radio" name="householdType" value="Two Full-Time" class="form-radio"> Two-parent household, two full-time working parents</label>
                                <label class="block"><input type="radio" name="householdType" value="One Full-Time, One Part-Time" class="form-radio"> Two-parent household, one full-time and one part-time</label>
                                <label class="block"><input type="radio" name="householdType" value="Other" class="form-radio"> Other</label>
                            </div>
                        </div>
                    </div>
                    <div class="mt-8 flex justify-between">
                        <button type="button" onclick="prevPage(2)" class="bg-slate-200 text-slate-800 font-semibold py-2 px-6 rounded-lg hover:bg-slate-300 transition">Back</button>
                        <button type="button" onclick="nextPage(2)" class="bg-teal-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-teal-700 transition">Next</button>
                    </div>
                </div>

                <div id="page-3" class="form-section">
                     <h2 class="text-2xl font-bold text-slate-800">Section 2: School Revenue Avenues</h2>
                     <p class="text-slate-600 mt-2">To keep tuition affordable, schools often explore other sources of revenue. Please select up to **three** initiatives you would be most likely to support or participate in.</p>
                     <div class="mt-6 space-y-3">
                         <label class="block p-4 border rounded-lg hover:bg-slate-50 cursor-pointer"><input type="checkbox" name="revenueAvenues" value="After-School Programs" class="form-checkbox"> Enhanced After-School Programs (e.g., Coding, Robotics, Arts)</label>
                         <label class="block p-4 border rounded-lg hover:bg-slate-50 cursor-pointer"><input type="checkbox" name="revenueAvenues" value="Summer Camps" class="form-checkbox"> Summer & Weekend Camps (Open to the public)</label>
                         <label class="block p-4 border rounded-lg hover:bg-slate-50 cursor-pointer"><input type="checkbox" name="revenueAvenues" value="Optional Service Charges" class="form-checkbox"> Slight increase in charges for optional services (e.g., hot lunch, field trips)</label>
                         <label class="block p-4 border rounded-lg hover:bg-slate-50 cursor-pointer"><input type="checkbox" name="revenueAvenues" value="Community Events" class="form-checkbox"> Participating in local community events/festivals to raise funds</label>
                         <label class="block p-4 border rounded-lg hover:bg-slate-50 cursor-pointer"><input type="checkbox" name="revenueAvenues" value="Publicity and Sponsorships" class="form-checkbox"> Seeking media publicity and corporate sponsorships</label>
                         <label class="block p-4 border rounded-lg hover:bg-slate-50 cursor-pointer"><input type="checkbox" name="revenueAvenues" value="Expand Fundraising Committee" class="form-checkbox"> Expanding the parent fundraising committee to recruit more volunteers</label>
                         <label class="block p-4 border rounded-lg hover:bg-slate-50 cursor-pointer"><input type="checkbox" name="revenueAvenues" value="Fundraising Gala" class="form-checkbox"> Annual Fundraising Gala / Dinner</label>
                         <label class="block p-4 border rounded-lg hover:bg-slate-50 cursor-pointer"><input type="checkbox" name="revenueAvenues" value="Alumni Program" class="form-checkbox"> Alumni Donation Program</label>
                         <label class="block p-4 border rounded-lg hover:bg-slate-50 cursor-pointer"><input type="checkbox" name="revenueAvenues" value="School Store" class="form-checkbox"> School Store (Merchandise)</label>
                     </div>
                     <div class="mt-8 flex justify-between">
                        <button type="button" onclick="prevPage(3)" class="bg-slate-200 text-slate-800 font-semibold py-2 px-6 rounded-lg hover:bg-slate-300 transition">Back</button>
                        <button type="button" onclick="nextPage(3)" class="bg-teal-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-teal-700 transition">Next</button>
                    </div>
                </div>

                <div id="page-4" class="form-section">
                    <h2 class="text-2xl font-bold text-slate-800">Section 3: General Feedback</h2>
                    <p class="text-slate-600 mt-2">Do you have any additional feedback, ideas, or concerns regarding tuition, fundraising, or the financial health of the school? Your honest and constructive input is highly valued.</p>
                    <div class="mt-6">
                        <textarea id="generalFeedback" rows="6" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-teal-500 focus:ring-teal-500"></textarea>
                    </div>
                    <div class="mt-8 flex justify-between">
                        <button type="button" onclick="prevPage(4)" class="bg-slate-200 text-slate-800 font-semibold py-2 px-6 rounded-lg hover:bg-slate-300 transition">Back</button>
                        <button type="button" onclick="nextPage(4)" class="bg-teal-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-teal-700 transition">Next</button>
                    </div>
                </div>
                
                <div id="page-5" class="form-section">
                    <h2 class="text-2xl font-bold text-slate-800">Final Step: Optional Validation</h2>
                    <p class="text-slate-600 mt-2">Providing your associated email helps us filter out spam and makes this data much more reliable for the school board.
                    <br><strong class="text-teal-700">Your email is never saved linked to your answers. It's only used for one time verification check against the school's database. </strong> If you prefer to not to provide an email, you may leave this field blank.</p>
                    <div class="mt-6">
                        <label for="email" class="block text-sm font-medium text-slate-700">Your SVA-Associated Parent Email (Optional)</label>
                        <input type="email" id="email" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-teal-500 focus:ring-teal-500">
                    </div>
                    <div class="mt-8 flex justify-between">
                        <button type="button" onclick="prevPage(5)" class="bg-slate-200 text-slate-800 font-semibold py-2 px-6 rounded-lg hover:bg-slate-300 transition">Back</button>
                        <button type="submit" class="bg-teal-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-teal-700 transition">Submit Survey</button>
                    </div>
                </div>
            </form>

            <div id="page-6" class="form-section text-center">
                 <h2 class="text-3xl font-bold text-teal-600">Thank You!</h2>
                 <p class="text-slate-600 mt-4 text-lg">Your submission has been recorded anonymously. Your feedback is invaluable in helping us plan for a sustainable and accessible future for all SVA students.</p>
                 <p class="text-sm mt-4 text-slate-500">You may now close this window.</p>
            </div>
            
            <div id="loading" class="form-section text-center p-8">
                <svg class="animate-spin h-10 w-10 text-teal-600 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <p class="mt-4 text-slate-600">Submitting your anonymous responses...</p>
            </div>
        </div>
    </div>

    <script>
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzVIpqeOBDdAQg01qDlYLVXyZWhl8J30OT8rvZzsCOB3g9P-GtZzBKuFrfafQ55cBU/exec';
        const totalPages = 4; // Number of pages with questions
        let currentPage = 1;

        document.getElementById('loadTime').value = Date.now();

        function updateProgress() {
            const progressPage = currentPage - 1;
            const percent = progressPage > 0 ? ((progressPage - 1) / totalPages) * 100 : 0;
            document.getElementById('progress-bar').style.width = `${percent}%`;
            document.getElementById('progress-percent').textContent = `${Math.round(percent)}%`;
            let stepText = `Step ${progressPage} of ${totalPages}`;
            if(progressPage === 1) stepText += ": Tuition Details";
            if(progressPage === 2) stepText += ": Revenue Avenues";
            if(progressPage === 3) stepText += ": General Feedback";
            if(progressPage === 4) stepText += ": Validation";
            document.getElementById('progress-text').textContent = stepText;
        }

        function showPage(pageNumber) {
            const progressContainer = document.getElementById('progress-container');
            if(pageNumber === 1 || pageNumber > totalPages + 1){
                progressContainer.style.display = 'none';
            } else {
                progressContainer.style.display = 'block';
            }
            document.querySelectorAll('.form-section').forEach(p => p.classList.remove('active'));
            document.getElementById(`page-${pageNumber}`).classList.add('active');
            currentPage = pageNumber;
            if(pageNumber > 1 && pageNumber <= totalPages + 1) {
                updateProgress();
            }
        }

        function nextPage(page) {
            document.querySelectorAll('.error-text').forEach(el => el.classList.remove('error-text'));
            let canProceed = true;
            
            if (page === 2) { // Now validating the first question page (page-2)
                const questions = ['householdIncome', 'receivesAid', 'householdType'];
                questions.forEach(q => {
                    if (!document.querySelector(`input[name="${q}"]:checked`)) {
                        canProceed = false;
                        document.querySelector(`input[name="${q}"]`).closest('.space-y-2').previousElementSibling.classList.add('error-text');
                    }
                });
                if (!canProceed) alert('Please complete all required fields in this section.');
            }
            
            if (canProceed && page < totalPages + 2) {
                showPage(page + 1);
            }
        }
        function prevPage(page) {
            if (page > 1) {
                showPage(page - 1);
            }
        }

        const studentCounts = { pkFullDay: 0, pkHalfDay: 0, elementary: 0, middleSchool: 0 };
        const tuitions = { pkFullDay: 16900, pkHalfDay: 15500, elementary: 11900, middleSchool: 13500 };

        document.querySelectorAll('.counter-btn').forEach(button => {
            button.addEventListener('click', () => {
                const groupDiv = button.closest('.grade-group');
                const groupName = groupDiv.dataset.group;
                const countSpan = groupDiv.querySelector('.count');
                let count = parseInt(countSpan.textContent);
                if (button.classList.contains('plus') && count < 6) count++;
                else if (button.classList.contains('minus') && count > 0) count--;
                countSpan.textContent = count;
                studentCounts[groupName] = count;
                calculateTuition();
            });
        });

        function calculateTuition() {
            const breakdownContainer = document.getElementById('tuition-breakdown');
            const detailsDiv = document.getElementById('tuition-details');
            const totalSpan = document.getElementById('total-tuition');
            detailsDiv.innerHTML = '';
            let totalTuition = 0;
            const k8Students = [];

            if (studentCounts.pkFullDay > 0) {
                const subtotal = studentCounts.pkFullDay * tuitions.pkFullDay;
                totalTuition += subtotal;
                detailsDiv.innerHTML += `<div>Pre-K (Full-Day): ${studentCounts.pkFullDay} x ${tuitions.pkFullDay.toLocaleString()} = ${subtotal.toLocaleString()}</div>`;
            }
            if (studentCounts.pkHalfDay > 0) {
                const subtotal = studentCounts.pkHalfDay * tuitions.pkHalfDay;
                totalTuition += subtotal;
                detailsDiv.innerHTML += `<div>Pre-K (Half-Day): ${studentCounts.pkHalfDay} x ${tuitions.pkHalfDay.toLocaleString()} = ${subtotal.toLocaleString()}</div>`;
            }
            
            for (let i = 0; i < studentCounts.elementary; i++) k8Students.push(tuitions.elementary);
            for (let i = 0; i < studentCounts.middleSchool; i++) k8Students.push(tuitions.middleSchool);

            k8Students.sort((a, b) => b - a); // Sort descending to apply discount to lower amounts
            
            let baseK8Tuition = 0;
            let discountAmount = 0;

            k8Students.forEach((tuition, index) => {
                baseK8Tuition += tuition;
                if (index > 0) {
                    discountAmount += tuition * 0.10;
                }
            });

            if (baseK8Tuition > 0) detailsDiv.innerHTML += `<div>Elementary/Middle Base Tuition: $${baseK8Tuition.toLocaleString()}</div>`;
            if (discountAmount > 0) detailsDiv.innerHTML += `<div class="text-green-600">Multi-Student Discount: -$${discountAmount.toLocaleString()}</div>`;

            totalTuition += (baseK8Tuition - discountAmount);
            breakdownContainer.style.display = totalTuition > 0 ? 'block' : 'none';
            totalSpan.textContent = `$${totalTuition.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
        }
        
        document.getElementById('survey-form').addEventListener('submit', function(e){
            e.preventDefault();
            showPage('loading'); // Use showPage to handle progress bar visibility

            const formData = {
                email: document.getElementById('email').value,
                user_nickname: document.querySelector('[name="user_nickname"]').value,
                loadTime: document.getElementById('loadTime').value,
                pkFullDay: studentCounts.pkFullDay, pkHalfDay: studentCounts.pkHalfDay,
                elementary: studentCounts.elementary, middleSchool: studentCounts.middleSchool,
                totalTuition: document.getElementById('total-tuition').textContent,
                tuitionLooksOk: document.querySelector('input[name="tuitionLooksOk"]:checked')?.value || 'N/A',
                householdIncome: document.querySelector('input[name="householdIncome"]:checked')?.value || 'N/A',
                receivesAid: document.querySelector('input[name="receivesAid"]:checked')?.value || 'N/A',
                householdType: document.querySelector('input[name="householdType"]:checked')?.value || 'N/A',
                revenueAvenues: Array.from(document.querySelectorAll('input[name="revenueAvenues"]:checked')).map(cb => cb.value),
                generalFeedback: document.getElementById('generalFeedback').value
            };

            fetch(WEB_APP_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                body: JSON.stringify(formData)
            })
            .then(() => { showPage(6); }) // Page 6 is the thank you page now
            .catch(error => {
                console.error('Error:', error);
                alert(`Submission failed due to a network error. Please try again.`);
                showPage(5); // Go back to the last page on error
            });
        });

        document.querySelectorAll('input[name="revenueAvenues"]').forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                if (document.querySelectorAll('input[name="revenueAvenues"]:checked').length > 3) {
                    alert('You can select up to three options.');
                    checkbox.checked = false;
                }
            });
        });

        document.querySelectorAll('input[type="radio"]').forEach(radio => {
            radio.addEventListener('change', (e) => {
                const label = e.target.closest('.space-y-2').previousElementSibling;
                if(label) label.classList.remove('error-text');
            });
        });
        
        showPage(1); // Start on the new cover page
    </script>
</body>
</html>



